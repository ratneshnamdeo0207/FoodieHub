<% layout("layouts/boilerplate") %>




<div class="container my-5">

  <div class="card  text-light shadow-lg border-0 rounded-4">
    <div class="card-body p-5">

      <div class="row">

        <!-- Profile Section -->
        <div class="col-md-4 text-center mb-4">
          <img 
            src="<%= user.profileImage?.url || '/default.png' %>" 
            class="rounded-circle border border-secondary shadow"
            style="width:180px; height:180px; object-fit:cover;"
            alt="Profile"
          >
          <h4 class="mt-3 fw-bold"><%= user.fullName %></h4>
          <span class="badge bg-secondary text-capitalize">
            <%= user.role %>
          </span>
        </div>

        <!-- Account Details -->
        <div class="col-md-8">

          <h3 class="fw-bold mb-4 text-info">Account Details</h3>

          <div class="row mb-3">
            <div class="col-sm-4 text-secondary">Username</div>
            <div class="col-sm-8 text-muted"><%= user.username %></div>
          </div>

           <div class="row mb-3">
            <div class="col-sm-4 text-secondary">Fullname</div>
            <div class="col-sm-8 text-muted"><%= user.fullName %></div>
          </div>

          <div class="row mb-3">
            <div class="col-sm-4 text-secondary">Email</div>
            <div class="col-sm-8 text-muted"><%= user.email %></div>
          </div>

          <div class="row mb-3">
            <div class="col-sm-4 text-secondary">Phone</div>
            <div class="col-sm-8 text-muted "><%= user.phone %></div>
          </div>

          <div class="row mb-3">
            <div class="col-sm-4 text-secondary">User ID</div>
            <div class="col-sm-8 text-muted"><%= user._id %></div>
          </div>

          <div class="row mb-3">
            <div class="col-sm-4 text-secondary">Created On</div>
            <div class="col-sm-8 text-muted">
              <%= user.createdAt.toDateString() %>
            </div>
          </div>

          <!-- Saved Addresses (Now Inside Details Section) -->
          <hr class="border-secondary my-4">

          <h5 class="fw-bold text-info mb-3">Saved Addresses</h5>

          <% if(user.addresses.length > 0) { %>
            <% user.addresses.forEach(address => { %>

              <div class="card bg-secondary bg-opacity-25 border-0 mb-3">
                <div class="card-body p-3">

                  <% if(address.isDefault) { %>
                    <span class="badge bg-info mb-2">Default</span>
                  <% } %>

                  <p class="mb-1">
                    <strong><%= address.houseNo %></strong>, 
                    <%= address.street %>
                  </p>

                  <p class="mb-1">
                    <%= address.city %>, <%= address.state %>
                  </p>

                  <p class="text-muted mb-0">
                    PIN: <%= address.pincode %>
                  </p>

                </div>
              </div>

            <% }) %>
          <% } else { %>
            <p class="text-muted">No saved addresses.</p>
          <% } %>

        </div>
      </div>

      <!-- Orders Section -->
      <hr class="border-secondary my-5">

      <h3 class="fw-bold text-info mb-4">Order History</h3>

      <% if(user.orders.length > 0) { %>

        <div class="row">

          <% user.orders.forEach(order => { %>

            <div class="col-md-6 mb-4">
              <div class="card bg-secondary bg-opacity-25 border-0 h-100 shadow-sm">
                <div class="card-body">

                  <h6 class="fw-bold text-light">
                    Order ID: 
                    <span class="text-info"><%= order._id %></span>
                  </h6>

                  <% if(order.totalAmount) { %>
                    <p class="mb-1">
                      Total: â‚¹ <%= order.totalAmount %>
                    </p>
                  <% } %>

                  <% if(order.status) { %>
                    <span class="badge bg-info text-dark">
                      <%= order.status %>
                    </span>
                  <% } %>

                  <% if(order.createdAt) { %>
                    <p class="text-muted mt-2 mb-0">
                      <%= order.createdAt.toDateString() %>
                    </p>
                  <% } %>

                </div>
              </div>
            </div>

          <% }) %>

        </div>

      <% } else { %>
        <p class="text-muted">No orders placed yet.</p>
      <% } %>

    </div>
  </div>

</div>


