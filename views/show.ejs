<% layout("layouts/boilerplate") %>

<div class="container py-5">

  <!-- ===== Restaurant Section ===== -->
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <div class="row g-0">

      <!-- Image -->
      <div class="col-md-6">
        <img 
          src="https://images.unsplash.com/photo-1555992336-03a23c9b6c9c"
          class="img-fluid h-100 w-100 object-fit-cover"
          style="min-height: 350px;"
          alt="Restaurant Image"
        >
      </div>

      <!-- Details -->
      <div class="col-md-6 p-4 p-lg-5">

        <h2 class="fw-bold mb-2"><%= rest.name %></h2>

        <p class="text-muted mb-2">
          <i class="bi bi-geo-alt-fill"></i> <%= rest.location %>
        </p>

        <h5 class="text-warning mb-3">
            <% 
                
                let avg = 0, total = 0;
                if(rest.reviews)
                {
                    for(let r of rest.reviews)
                    {
                        total += r.rating
                    }
                    avg = total/rest.reviews.length
                }
                
                
                %>
           
          ⭐ <%= avg.toFixed(1) %> / 5
        </h5>

        <p class="text-secondary">
          <%= rest.description %>
        </p>

        <hr>

        <div class="row mb-3">
          <div class="col-6">
            <strong>Category:</strong><br>
            <span class="text-muted"><%= rest.Category %></span>
          </div>

          <div class="col-6">
            <strong>Price Range:</strong><br>
            <span class="text-muted">
              ₹<%= rest.startingPrice %> – ₹<%= rest.endingPrice %>
            </span>
          </div>
        </div>

        <p>
          <strong>Timings:</strong>
          <span class="text-muted">
            <%= rest.openingHour %> – <%= rest.closingHour %>
          </span>
        </p>

        <div class="mt-4">
          <a href="/restaurants/<%= rest.id %>/edit" class="btn btn-outline-dark rounded-pill px-4 me-2">
            Edit
          </a>

          <form action="/restaurants/<%= rest.id %>?_method=DELETE" method="POST" class="d-inline">
            <button class="btn btn-danger rounded-pill px-4">
              Delete
            </button>
          </form>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Review Form ===== -->
  <div class="card border-0 shadow-sm rounded-4 p-4 mt-5">
    <h4 class="mb-4">Leave a Review</h4>

    <form action="/show/<%= rest.id %>/review" method="POST" novalidate class="needs-validation">

      <!-- Rating -->
      <div class="mb-3">
        <fieldset class="starability-coinFlip mb-3">
            <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked />
            <input type="radio" id="rate1" name="review[rating]" value="1" /><label for="rate1">1 star.</label>
            <input type="radio" id="rate2" name="review[rating]" value="2" /><label for="rate2">2 stars.</label>
            <input type="radio" id="rate3" name="review[rating]" value="3" /><label for="rate3">3 stars.</label>
            <input type="radio" id="rate4" name="review[rating]" value="4" /><label for="rate4">4 stars.</label>
            <input type="radio" id="rate5" name="review[rating]" value="5" /><label for="rate5">5 stars.</label>
            <span class="starability-focus-ring"></span>
          </fieldset>
        <!-- <label class="form-label fw-semibold">Rating</label>
        <select name="review[rating]" class="form-select rounded-3" required>
          <option value="">Choose Rating</option>
          <option value="1">1 ⭐</option>
          <option value="2">2 ⭐</option>
          <option value="3">3 ⭐</option>
          <option value="4">4 ⭐</option>
          <option value="5">5 ⭐</option>
        </select> -->
        <div class="invalid-feedback">Please select a rating</div>
      </div>

      <!-- Comment -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Comment</label>
        <textarea 
          name="review[comment]" 
          class="form-control rounded-3" 
          rows="4" 
          placeholder="Write your experience..."
          required>
        </textarea>
        <div class="invalid-feedback">Please add a comment</div>
      </div>

      <button class="btn btn-dark rounded-pill px-4">
        Submit Review
      </button>

    </form>
  </div>

  <!-- ===== Reviews Section ===== -->
  <div class="mt-5">
    <h4 class="mb-4">Customer Reviews</h4>

    <div class="row g-4">
      <% for(let r of rest.reviews) { %>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm rounded-4 h-100 p-4">

            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="text-warning mb-0">
                ⭐ <%= r.rating %>
              </h6>
              <small class="text-muted">
                <%= new Date(r.createdAt).toDateString() %>
              </small>
            </div>

            <p class="text-secondary">
              <%= r.comment %>
            </p>

            <hr>

            <small class="text-muted">— Anonymous</small>

          </div>
        </div>
      <% } %>
    </div>

  </div>

</div>

